<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MSSA Mayhem App</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React & ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <!-- Babel for in-browser JSX transpiling -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Marked UMD for Markdown -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js" integrity="sha512-63iBJhQlDJRy6dAXfR7kFcWaC0r2dWqb7b/BD8+6pxyIuwFJMx7Qq49zboKA9AnmijJFL2GMWb4p/5Q4uUM0zA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body class="bg-gray-100">
  <div id="root" class="max-w-xl mx-auto mt-10 space-y-6"></div>

  <script type="text/babel">
    const { useState } = React;

    // Icons
    const InfoIcon = ({ className }) => (
      <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}
          d="M13 16h-1v-4h-1m1-4h.01M12 2.25c5.385 0 
             9.75 4.365 9.75 9.75S17.385 21.75 12 21.75 
             2.25 17.385 2.25 12 6.615 2.25 12 2.25z" />
      </svg>
    );
    const ShieldCheckIcon = ({ className }) => (
      <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2}
          d="M9 12l2 2 4-4m1-2a9 9 0 
             11-8 0v5a2 2 0 002 2h4a2 2 0 010 0V6z" />
      </svg>
    );

    // Drug info markdown
    const drugInfo = {
      Vancomycin: `**Vancomycin**\n- Spectrum: Gram-positive, including MRSA\n- PK: Time-dependent killing, IV only, renal clearance\n- Toxicities: Nephrotoxicity, red man syndrome`,
      Cefazolin: `**Cefazolin**\n- Spectrum: MSSA, Streptococci\n- PK: Time-dependent killing, IV, renally cleared\n- Toxicities: Rare hypersensitivity, generally well tolerated`,
      Nafcillin: `**Nafcillin**\n- Spectrum: MSSA only\n- PK: IV, hepatic metabolism\n- Toxicities: Interstitial nephritis, phlebitis, liver enzyme elevations`,
      Daptomycin: `**Daptomycin**\n- Spectrum: MRSA, VRE\n- PK: Concentration-dependent killing, inactivated by lung surfactant\n- Toxicities: Myopathy, requires CK monitoring`,
      Ceftriaxone: `**Ceftriaxone**\n- Spectrum: Broad Gram-negative and some Gram-positive\n- PK: Time-dependent killing, IV/IM, hepatic and renal elimination\n- Toxicities: Biliary sludging, GI upset, rash`
    };

    // Scenario definitions
    const scenarios = {
      intro: {
        text: `On a chilly evening, while sipping your chamomile tea with honey in the internal medicine staff room where you work as a physician assistant,
suddenly the phone rings. After confirming (damn it) that there‚Äôs no one else around to answer, you pick up the receiver:
"Hello, this is the microbiology lab. Mr. Nehmadi Nehmad has Staphylococcus aureus in his blood culture. Sensitivities will be ready tomorrow. Got it?"
"Got it."

What treatment would you recommend the on-call resident start for the nice gentleman?`,
        options: ["empiric"]
      },
      empiric: {
        text: `You consider empiric treatment options. It‚Äôs nighttime, sensitivities aren‚Äôt back yet, and all eyes are on you.
What do you start for now?`,
        options: ["VancomycinEmp", "CefazolinEmp", "NafcillinEmp", "Ceftriaxone"]
      },
      VancomycinEmp: {
        text: `You start Vancomycin. It covers both MRSA (methicillin-resistant Staphylococcus aureus) and MSSA (methicillin-sensitive Staphylococcus aureus), and is a reasonable empiric choice in settings with high MRSA prevalence.

However, Vancomycin is less effective than beta-lactams for treating MSSA. Studies have shown worse outcomes in patients treated with Vancomycin when the pathogen was actually sensitive.

The next day, sensitivities return: the bug is MSSA.`,
        options: ["start"]
      },
      CefazolinEmp: {
        text: `You start Cefazolin. It is the drug of choice for MSSA, but it does not cover MRSA.

It‚Äôs great for empiric treatment in low MRSA-risk settings.

The next day, sensitivities return: the bug is MSSA.`,
        options: ["start"]
      },
      NafcillinEmp: {
        text: `You start Nafcillin. Highly effective against MSSA, but not MRSA.

Next day: bug is MSSA.`,
        options: ["start"]
      },
      start: {
        text: `Your senior looks at you. ‚ÄúYour call. What‚Äôs the best antibiotic?‚Äù`,
        options: ["Vancomycin", "Cefazolin", "Nafcillin", "Daptomycin"]
      },
      Vancomycin: {
        text: `‚ùå MSSA + Vancomycin = not your best combo. Patient stays positive, creatinine climbs.`,
        options: ["Restart"]
      },
      Cefazolin: {
        text: `üéâ You win! Patient defervesces in 48 h, kidney safe.`,
        options: ["Restart"]
      },
      Nafcillin: {
        text: `‚úÖ Works, but watch toxicity and labs.`,
        options: ["Restart"]
      },
      Daptomycin: {
        text: `‚ùå Too broad (MRSA/VRE drug), budget pain.`,
        options: ["Restart"]
      },
      Ceftriaxone: {
        text: `‚ùå Nice try, but MSSA needs a beta-lactam.`,
        options: ["Restart"]
      }
    };

    // Modal component
    function Modal({ title, content, onClose }) {
      return (
        <div className="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
          <div className="bg-white p-4 rounded-lg border border-blue-200 shadow-xl max-w-md w-11/12">
            <div className="flex items-center mb-2">
              <ShieldCheckIcon className="w-5 h-5 text-green-600 mr-2" />
              <h5 className="text-blue-800 font-semibold">{title} Info</h5>
              <button onClick={onClose} className="ml-auto text-gray-500 hover:text-gray-800">‚úï</button>
            </div>
            <div
              className="text-sm text-gray-800 whitespace-pre-wrap"
              dangerouslySetInnerHTML={{ __html: marked.parse(content) }}
            />
          </div>
        </div>
      );
    }

    // Main App
    function MSSAMayhemApp() {
      const [scene, setScene] = useState("intro");
      const [modal, setModal] = useState(null);

      const choose = (opt) => setScene(opt === "Restart" ? "intro" : opt);

      const renderText = (text) => {
        return text.split(/(\bVancomycin\b|\bCefazolin\b|\bNafcillin\b|\bDaptomycin\b|\bCeftriaxone\b)/g)
          .map((w, i) => {
            const key = w.replace("Emp", "");
            if (drugInfo[key]) {
              return (
                <button
                  key={i}
                  className="inline-flex items-center px-1 text-blue-600 hover:underline"
                  onClick={() => setModal({ title: key, content: drugInfo[key] })}
                >
                  {key} <InfoIcon className="w-4 h-4 ml-1" />
                </button>
              );
            }
            return <span key={i}>{w}</span>;
          });
      };

      return (
        <div className="space-y-4">
          <div className="bg-white p-6 rounded shadow text-lg whitespace-pre-line">
            {renderText(scenarios[scene].text)}
          </div>
          <div className="flex flex-col space-y-2">
            {scenarios[scene].options.map((opt) => {
              const label = opt === "start" ? "Next" : opt.replace("Emp", "");
              return (
                <div key={opt} className="flex items-center space-x-2">
                  <button
                    onClick={() => choose(opt)}
                    className="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 rounded"
                  >
                    {label}
                  </button>
                  {drugInfo[label] && (
                    <button
                      onClick={() => setModal({ title: label, content: drugInfo[label] })}
                      className="inline-flex items-center border border-blue-500 hover:bg-blue-50 px-3 py-1 rounded"
                    >
                      <ShieldCheckIcon className="w-5 h-5 text-green-600 mr-1" />
                      Info
                    </button>
                  )}
                </div>
              );
            })}
          </div>
          {modal && <Modal {...modal} onClose={() => setModal(null)} />}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<MSSAMayhemApp />);
  </script>
</body>
</html>